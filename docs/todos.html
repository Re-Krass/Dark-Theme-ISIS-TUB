<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Todos</title>

    <!-- Meta Tags -->
    <meta name="author" content="B4rtware, Re-Krass">
    <meta name="publisher" content="B4rtware, Re-Krass">
    <meta name="copyright" content="B4rtware, Re-Krass">
    <meta name="description" content="todos for dark theme" />
    <meta name="keywords" content="dark theme isis todo">
    <meta name="page-topic" content="Dienstleistung">
    <meta name="page-type" content="Software Download">
    <meta name="audience" content="Alle">
    <meta http-equiv="content-language" content="en">
    <meta name="robots" content="index, follow">

    <!-- Links -->
    <link
      href="https://fonts.googleapis.com/css?family=Source+Code+Pro"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link href="styles/css/main.css" rel="stylesheet" />

    <!-- Load an icon library to show a hamburger menu (bars) on small screens -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>

  <body>
    <header>
      <div class="topnav" id="myTopnav">
          <a href="index.html">Home</a>
          <a href="todos.html" class="active">Todo</a>
          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
              <i class="fa fa-bars"></i>
          </a>
      </div>
      <script>
          function myFunction() {
              var x = document.getElementById("myTopnav");
              if (x.className === "topnav") {
                  x.className += " responsive";
              } else {
                  x.className = "topnav";
              }
          }
      </script>
    </header>
    <main>
      <section class="info">
        <div class="window">
          <div class="window__header">$: Todos
            <span class="window__header__icon">
              <a href="index.html"><i class="material-icons">close</i></a>
          </div>
          <div class="window__file">
            <span class="window__file__icon">
              <i class="material-icons">folder</i>
            </span>
            dark-theme-isis-tub.user.css
          </div>
          <div id="todos-item-container" class="window__item-container">
            <!-- todo items get inserted here via javascript -->
          </div>
          <div class="window__footer">
            <div class="window__footer__icon">
            </div>
            <div class="window__meta">
              <div id="todos-meta-last-modified" class="window__meta__last-modified">
                <!-- this date gets set by javascript -->
              </div>
            </div>
          </div>
        </div>
      </section>
      <!--<p><a href="/docs/index.html"> Homepage</a></p>-->
    </main>

    <footer></footer>
  </body>
  <script language="javascript" type="text/javascript">

  /**
   * @param {String} HTML representing a single element
   * @return {Element}
   * src: https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518
   */
  function htmlToElement(html) {
      var template = document.createElement('template');
      html = html.trim(); // Never return a text node of whitespace as the result
      template.innerHTML = html;
      return template.content.firstChild;
  }

  // get the header of the json file to get the last modified date
  // src: http://youmightnotneedjquery.com/
  var last_modified_request = new XMLHttpRequest();
  last_modified_request.open("HEAD", 'todos.json', true);
  last_modified_request.onload = () => {
    if (last_modified_request.status >= 200 && last_modified_request.status < 400) {
      // get the last modified date 
      var last_modified = last_modified_request.getResponseHeader("Last-Modified");
      var last_modified_elem = document.getElementById("todos-meta-last-modified");
      // set the last modified date in the associated element by id
      last_modified_elem.innerText = "last updated: " + last_modified;
      
    } else {
      console.log("error getting todos.json file!");
    }
  }
  last_modified_request.onerror = () => {
    console.log("error getting todos.json file!");
  };

  // get the json files content through an async request
  var request = new XMLHttpRequest();
  request.open('GET', 'todos.json', true);

  request.onload = function() {
    if (request.status >= 200 && request.status < 400) {
      var data = JSON.parse(request.responseText);
      var item_container = document.getElementById("todos-item-container")
      data.forEach(todo => {
        // use the modifier if its an empty message
        var modifier = "";
        // if the message if empty output a warning message to the user
        if (!todo["text"]) {
          todo["text"] = "&#60;no message provided&#62;";
          modifier = "window__item__message--empty";
        }
        var todo = htmlToElement(
          `
          <div class="window__item">
            <div class='window__item__line'>line ${todo["line"]}</div>
            <div class='window__item__type'>${todo["tag"]}</div>
            <div class='window__item__message ${modifier}'>${todo["text"]}</div>
          </div>
          `
        )
        // append the new created todo item into the container
        item_container.appendChild(todo)
      });
    } else {
      console.log("error while trying to read the todo.json file!")
    }
  };

  request.onerror = function() {
    // There was a connection error of some sort
  };
  // call those async functions
  last_modified_request.send();
  request.send();
  </script> 
</html>
